var queueStatus=0;$(document).ready(function(){function e(){$(".loader").show(),$(".loader-text").show(),0==queueStatus&&$(".loader-text").text("Refreshing data. Go grab a drink..."),$(".stats-container").empty(),$.get("/bungie/pve/update",function(a){2==a.status?($(".loader-text").text("Resync already in progress. Queueing..."),queueStatus=1,setTimeout(e,5e3)):(queueStatus=0,refreshBtn=$("button.refresh-btn"),refreshBtn.prop("disabled",!1),t())})}function t(){$.get("/bungie/members/get",function(e){e.length>0?($(".loader-text").text("Fetching PvE Stats..."),$.get("/bungie/pve/get",function(t){for(var a=[],i=0;i<e.length;i++)$(".loader-text").text("Processing "+(i+1)+" of "+e.length+"..."),pveData=t.filter(function(t){return t.user_id==e[i].destinyUserInfo.membershipId})[0],a.push({name:e[i].destinyUserInfo.displayName,kills:pveData.kills,deaths:pveData.deaths,suicides:pveData.suicides,killsDeathsRatio:pveData.killsDeathsRatio,activitiesCleared:pveData.activitiesCleared,weaponKillsSuper:pveData.weaponKillsSuper,weaponKillsMelee:pveData.weaponKillsMelee,weaponKillsGrenade:pveData.weaponKillsGrenade,publicEventsCompleted:pveData.publicEventsCompleted,heroicPublicEventsCompleted:pveData.heroicPublicEventsCompleted});$(".loader-text").text("Generating Table..."),$(".stats-container").append('<div id="pve-stats-table"></div>'),$(".loader").hide(),$(".loader-text").hide();var r={precision:0};new Tabulator("#pve-stats-table",{data:a,layout:"fitColumns",columns:[{title:"Name",field:"name",formatter:"money",formatterParams:r,frozen:!0},{title:"Kills",field:"kills",formatter:"money",formatterParams:r},{title:"Deaths",field:"deaths",formatter:"money",formatterParams:r},{title:"Suicides",field:"suicides",formatter:"money",formatterParams:r},{title:"K/D",field:"killsDeathsRatio",formatter:"money",formatterParams:r},{title:"Activities",field:"activitiesCleared",formatter:"money",formatterParams:r},{title:"Super Kills",field:"weaponKillsSuper",formatter:"money",formatterParams:r},{title:"Melee Kills",field:"weaponKillsMelee",formatter:"money",formatterParams:r},{title:"Grenade Kills",field:"weaponKillsGrenade",formatter:"money",formatterParams:r},{title:"Public Event",field:"publicEventsCompleted",formatter:"money",formatterParams:r},{title:"Heroic Public Event",field:"heroicPublicEventsCompleted",formatter:"money",formatterParams:r}],initialSort:[{column:"name",dir:"asc"}],layout:"fitDataFill",resizableColumns:!1});$(".stats-container").append('<div id="weapon-stats-info" class="text-center"><small>Last checked: '+pveData.last_updated+'</small> <br/><button type="button" class="btn btn-primary btn-sm badge badge-info refresh-btn"><i class="fas fa-sync-alt"></i> Resync data</button></div>')})):$(".loader-text").html("Unable to retrieve members ðŸ˜Ÿ <br/>Bungie API might be under maintenance")})}$(document).on("click","button.refresh-btn",function(){refreshBtn=$(this),refreshBtn.prop("disabled",!0),e()}),t()});
