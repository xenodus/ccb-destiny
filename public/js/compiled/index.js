$(document).ready(function(){$("#weeklies-item-container").hide(),$.get("/api/vendor",function(e){var t="3347378076",i="2917531897",o="672118013",a="863940356",r="248695599",s="895295461",d="2190858386",c="3361454721",l=["Gambit Bounty","Weekly Drifter Bounty"],m=["Emote","Ghost Shell","Ship","Transmat Effect","Vehicle","Weapon Ornament","Armor Ornament"],p=["WANTED: Combustor Valus","WANTED: Arcadian Chord","WANTED: The Eye in the Dark","WANTED: Gravetide Summoner","WANTED: Silent Fang","WANTED: Blood Cleaver"];e.length>0&&(raid_bounties=e.filter(function(e){return e.vendor_hash==t&&"Weekly Bounty"==e.itemTypeDisplayName}),gambit_bounties=e.filter(function(e){return e.vendor_hash==r&&l.includes(e.itemTypeDisplayName)}),power_surge_bounties=e.filter(function(e){return e.vendor_hash==r&&"Power Surge Bounty"==e.itemTypeDisplayName}),spider_wares=e.filter(function(e){return e.vendor_hash==a&&""==e.itemTypeDisplayName}),spider_powerful_bounty=e.filter(function(e){return e.vendor_hash==a&&"Weekly Bounty"==e.itemTypeDisplayName&&p.includes(e.name)}),banshee_wares=e.filter(function(e){return e.vendor_hash==o&&""!=e.icon}),xur_wares=e.filter(function(e){return e.vendor_hash==d&&"Challenge Card"!=e.itemTypeDisplayName&&"Invitation of the Nine"!=e.itemTypeDisplayName}),tess_wares=e.filter(function(e){return e.vendor_hash==c&&m.includes(e.itemTypeDisplayName)}),saladin_bounties=e.filter(function(e){return e.vendor_hash==s&&"Iron Banner Bounty"==e.itemTypeDisplayName}),ada_frames=e.filter(function(e){return e.vendor_hash==i&&"Ballistics Log"==e.cost_name}),raid_bounties.length>0&&$("#weeklies-item-container").append(n(raid_bounties,"Raid "+(raid_bounties.length>1?"Bounties":"Bounty"))),ascendant_challenge=function(){var e={"Gardens of Esila":"At the overlook's edge, the garden grows onward.","Spine of Keres":"Climb the bones and you'll find your ruin.","Harbinger’s Seclude":"Crush the first queen's crown beneath your bootheel.","Bay of Drowned Wishes":"Drown in your wishes, dear squanderer.","Chamber of Starlight":"Starlight, star bright, first untruth she'll craft tonight...","Aphelion’s Rest":"They call it a 'rest,' but it is more truly a haunt."},n=moment("2019-01-16 01:00:00","YYYY-MM-DD H:mm:ss"),t=moment(),i=0,o=!1;for(;0==o;)i==Object.keys(e).length&&(i=0),nextWeek=moment(n.format("YYYY-MM-DD H:mm:ss"),"YYYY-MM-DD H:mm:ss").add(7,"days"),t.isBetween(n,nextWeek)?o=!0:(n=nextWeek,i++);return[{name:"Ascendant: "+Object.keys(e)[i],icon:"/common/destiny2_content/icons/2f9e7dd03c415eb158c16bb59cc24c84.jpg",description:e[Object.keys(e)[i]]}]}(),weekly_dc_mission=function(){var e={"Broken Courier":"Respond to a distress call in the Strand.","Oracle Engine":"The Taken threaten to take control of an irreplaceable Awoken communications device.","Dark Monastery ":"Provide recon for Petra's forces by investigating strange enemy activity in Rheasilvia."},n=moment("2019-01-16 01:00:00","YYYY-MM-DD H:mm:ss"),t=moment(),i=0,o=!1;for(;0==o;)i==Object.keys(e).length&&(i=0),nextWeek=moment(n.format("YYYY-MM-DD H:mm:ss"),"YYYY-MM-DD H:mm:ss").add(7,"days"),t.isBetween(n,nextWeek)?o=!0:(n=nextWeek,i++);return[{name:"Mission: "+Object.keys(e)[i],icon:"/common/destiny2_content/icons/a6ce21a766375f5bcfb6cc01b093a383.png",description:e[Object.keys(e)[i]]}]}(),curse_level=function(){var e=["Low","Medium","High"],n=moment("2019-01-16 01:00:00","YYYY-MM-DD H:mm:ss"),t=moment(),i=0,o=!1;for(;0==o;)i==Object.keys(e).length&&(i=0),nextWeek=moment(n.format("YYYY-MM-DD H:mm:ss"),"YYYY-MM-DD H:mm:ss").add(7,"days"),t.isBetween(n,nextWeek)?o=!0:(n=nextWeek,i++);var a="The curse level is <u>"+e[i].toLowerCase()+"</u> in the Dreaming City.";2==i&&(a+=" Shattered Throne is up.");return[{name:"Curse Level: "+e[i],icon:"/common/destiny2_content/icons/8f755eb3a9109ed7adfc4a8b27871e7a.png",description:a}]}(),ascendant_challenge.length>0&&weekly_dc_mission.length>0&&curse_level.length>0&&$("#weeklies-item-container").append(n(ascendant_challenge.concat(weekly_dc_mission).concat(curse_level),'Dreaming City <small style="font-size: 70%;font-style: italic;"><a href="https://i.imgur.com/LA9TMcS.jpg" data-title="https://i.imgur.com/LA9TMcS.jpg" data-lightbox="Ascendant Challenge Map" target="_blank">Ascendant Challenge Map <i class="fas fa-external-link-alt"></i></a></small>')),outbreak_config=function(){var e=["Void","Arc","Solar"],n=moment("2019-05-08 01:00:00","YYYY-MM-DD H:mm:ss"),t=moment(),i=0,o=!1;for(;0==o;)i==Object.keys(e).length&&(i=0),nextWeek=moment(n.format("YYYY-MM-DD H:mm:ss"),"YYYY-MM-DD H:mm:ss").add(7,"days"),t.isBetween(n,nextWeek)?o=!0:(n=nextWeek,i++);var a="The configuration type is <u>"+e[i].toUpperCase()+"</u> for Zero Hour (Heroic).";return[{name:"Singe Config: "+e[i].toUpperCase(),icon:"/common/destiny2_content/icons/c013e41cdb32779bc2322337614ea06b.jpg",description:a}]}(),outbreak_config.length>0&&$("#weeklies-item-container").append(n(outbreak_config,'Outbreak Catalyst <small style="font-size: 70%;font-style: italic;"><a href="/outbreak">Solution Generator <i class="fas fa-external-link-alt"></i></a></small>')),banshee_wares.length>0&&$("#weeklies-item-container").append(n(banshee_wares,"Banshee-44's Mods")),spider_powerful_bounty.length>0&&$("#weeklies-item-container").append(n(spider_powerful_bounty,"Spider's Powerful Bounty")),spider_wares.length>0&&$("#weeklies-item-container").append(n(spider_wares,"Spider's Wares")),escalation_protocol=function(){var e={"Kathok, Roar of Xol":{name:"IKELOS_SMG_v1.0.1",icon:"/common/destiny2_content/icons/85ad82abdfc13537325b45a85d6f4462.jpg"},"Damkath, The Mask":{name:"IKELOS_SR_v1.0.1",icon:"/common/destiny2_content/icons/52630df015ef0e839555982c478d78f3.jpg"},"Naksud, the Famine":{name:"All 3 Weapons",icon:"/common/destiny2_content/icons/d316fa414f16795f5f0674a35d2bdae7.jpg"},"Bok Litur, Hunger of Xol":{name:"All 3 Weapons",icon:"/common/destiny2_content/icons/d316fa414f16795f5f0674a35d2bdae7.jpg"},"Nur Abath, Crest of Xol":{name:"IKELOS_SG_v1.0.1",icon:"/common/destiny2_content/icons/edfdd807c9d604e80b48ad8fe39c8f36.jpg"}},n=moment("2019-01-16 01:00:00","YYYY-MM-DD H:mm:ss"),t=moment(),i=0,o=!1;for(;0==o;)i==Object.keys(e).length&&(i=0),nextWeek=moment(n.format("YYYY-MM-DD H:mm:ss"),"YYYY-MM-DD H:mm:ss").add(7,"days"),t.isBetween(n,nextWeek)?o=!0:(n=nextWeek,i++);return[{name:e[Object.keys(e)[i]].name,icon:e[Object.keys(e)[i]].icon,description:"Boss: "+Object.keys(e)[i]}]}(),escalation_protocol.length>0&&$("#weeklies-item-container").append(n(escalation_protocol,"Escalation Protocol")),saladin_bounties.length,raid_lair_modifiers={Gladiator:{name:"Prestige: Gladiator",description:"Melee kills buff weapon damage, and weapon kills buff melee damage.",icon:"https://bungie.net/common/destiny2_content/icons/8d4cc5b8420f2a647c877610b9f286ed.png"},Arsenal:{name:"Prestige: Arsenal",description:"Weapons have no reserve ammo. Emptying the clip of a weapon refills the clips of your holstered weapons.",icon:"https://bungie.net/common/destiny2_content/icons/5e870c7f571cf35554183a9b330cbf23.png"},Prism:{name:"Prism",description:"Attacks matching the periodically rotating focused element do more damage. Other elemental damage is reduced. Incoming damage is unaffected.",icon:"https://bungie.net/common/destiny2_content/icons/7cd52fc7131a02c6b03544df779cb8c6.png"}},current_raid_lair_modifiers={loadouts:{primary:"SMG",energy:"Anything",power:"Grenade Launcher"},modifier:{name:raid_lair_modifiers.Prism.name,description:raid_lair_modifiers.Prism.description,icon:raid_lair_modifiers.Prism.icon},expiry:moment("2019-02-13 01:00:00","YYYY-MM-DD H:mm:ss"),updated:"2019-02-07 02:00:00"},current_raid_lair_modifiers.expiry.diff()>0&&$("#weeklies-item-container").append(function(e){var n="\n    <h6 class='font-weight-bold mb-1'>"+e.modifier.name+"</h6>\n    <div>"+e.modifier.description+"</div>\n    ";return'\n    <div class="mb-3 border-warning border">\n      <div class="border-warning border-bottom p-2">Y1 Prestige Raid Lair Modifiers</div>\n      <div class="pl-2 pr-2 pt-2 pb-1">\n        <div class="mb-1 vendor-item">\n          <div><u>Loadout</u></div>\n          <div class="d-flex">\n            <img class="img-fluid" src="https://bungie.net/common/destiny2_content/icons/dc4bb9bcdd4ae8a83fb9007a51d7d711.png" style="width: 20px; height: 20px; margin-right: 5px;"/> Primary: '+e.loadouts.primary+'\n          </div>\n          <div class="d-flex">\n            <img class="img-fluid" src="https://bungie.net/common/destiny2_content/icons/b6d3805ca8400272b7ee7935b0b75c79.png" style="width: 20px; height: 20px; margin-right: 5px;"/> Energy: '+e.loadouts.energy+'\n          </div>\n          <div class="d-flex">\n            <img class="img-fluid" src="https://bungie.net/common/destiny2_content/icons/9fa60d5a99c9ff9cea0fb6dd690f26ec.png" style="width: 20px; height: 20px; margin-right: 5px;"/> Power: '+e.loadouts.power+'\n          </div>\n          <div class="mt-2"><u>Modifier</u></div>\n          <div class="d-flex mt-1" data-toggle="tooltip" title="'+n+'">\n            <img class="img-fluid" src="'+e.modifier.icon+'" style="width: 20px; height: 20px; margin-right: 5px;"/>\n            '+e.modifier.name+"\n          </div>\n        </div>\n      </div>\n    </div>\n    "}(current_raid_lair_modifiers)),tess_wares.length>0&&$("#weeklies-item-container").append(n(tess_wares,"Tess's Precious")),$('[data-toggle="tooltip"]').tooltip({html:!0})),$.get("/api/nightfall",function(e){e.length>0&&($("#weeklies-item-container").prepend(n(e,"Nightfalls")),$('[data-toggle="tooltip"]').tooltip({html:!0})),$.get("/api/levi",function(e){e.order&&$("#weeklies-item-container").prepend(n([{icon:"/common/destiny2_content/icons/b8177e166f01c2cd914fc3e925ae902d.png",name:e.order}],"Leviathan")),$.get("/api/sales-item-perks/"+d,function(e){xur_wares.length>1&&($("#weeklies-item-container").prepend(function(e,n,t="vertical",i){str='\n    <div class="grid-item col-md-4">\n      <div class="mb-3 border-warning border">\n        <div class="border-warning border-bottom p-2 text-left">'+n+'</div>\n        <div class="pl-2 pr-2 pt-2 pb-1 '+("vertical"==t?"":"d-md-flex flex-md-wrap justify-content-md-around")+'">\n    ';for(var o=0;o<e.length;o++){var a="",r="",s="",d=i.filter(function(n){return n.vendor_sales_id==e[o].id});if(e[o].description){if(e[o].cost&&(r="<div class='mt-2'>Price: "+e[o].cost+" "+e[o].cost_name+"</div>"),d.length>0){s="<div class='mt-2'>",prev_perk_group="",roll=1;for(var c=0;c<d.length;c++)0==c?s+="<div class='mb-1'>Perk "+roll+"</div><div class='mb-2 border border-secondary rounded'>":prev_perk_group!=d[c].perk_group&&(roll++,s+="</div><div class='mt-1 mb-1'>Perk "+roll+"</div><div class='mb-2 border border-secondary rounded'>"),s+="<div class='d-flex align-items-center pt-1 pb-2 pl-2 pr-2 "+(prev_perk_group==d[c].perk_group&&0!=c?"border-top border-secondary":"")+"'>\n                        <div>\n                          <img src='https://bungie.net"+d[c].icon+"' class='mt-1 mb-1 mr-2 tooltip-icon' style='width: 30px; height: 30px;'/>\n                        </div>\n                        <div>\n                          <div class='font-weight-bold'>"+d[c].name.replace(/"/g,"'")+"</div>\n                          <div class='perk-description mt-1'>"+d[c].description.replace(/"/g,"'").replace(/•/g,"<br>• ")+"</div>\n                        </div>\n                      </div>",c+1==d.length&&(s+="</div>"),prev_perk_group=d[c].perk_group;s+="</div>"}a="\n        <div>\n          <h6 class='font-weight-bold mb-1'>"+e[o].name+"</h6>\n          <div class='d-flex align-items-start'>\n            <div>\n              <img src='https://bungie.net"+e[o].icon+"' class='mt-1 mb-1 mr-2 tooltip-icon' style='width: 50px; height: 50px;'/>\n            </div>\n            <div>"+e[o].description.replace(/"/g,"'")+"</div>\n          </div>\n          "+r+"\n          "+s+"\n        </div>\n        "}str+='\n      <div class="d-flex mb-1 vendor-item" data-toggle="tooltip" title="'+a+'">\n        <img class="img-fluid" src="https://bungie.net'+e[o].icon+'" style="width: 20px; height: 20px; margin-right: 5px;"/>'+e[o].name+"\n      </div>\n      "}return str+="\n        </div>\n      </div>\n    </div>\n    ",str}(xur_wares,'Xur\'s Shinies <small style="font-size: 70%;font-style: italic;"><a href="https://wherethefuckisxur.com/" target="_blank" id="xur-link">Where is Xur? <i class="fas fa-external-link-alt"></i></a></small>',"vertical",e)),$('[data-toggle="tooltip"]').tooltip({html:!0})),$("section#weeklies > div.loader, section#weeklies > div.loader-text").hide(),$("#weeklies-item-container").fadeIn(),$(".grid").masonry({itemSelector:".grid-item",gutter:0,columnWidth:".grid-sizer",gutter:".gutter-sizer",percentPosition:!0}),$.get("/api/xur",function(e){e.location&&$("a#xur-link").text(e.location)})})})})});var e={"Nightfall: Tree of Probabilities":{name:"D.F.A.",icon:"/common/destiny2_content/icons/6e692a14162839d0489e11cf9d84746e.jpg",description:'"Osiris said that he started to pity the Red Legion, getting trapped in here for infinite eternities. I think they\'re getting exactly what they deserve." —Sagira',type:"Legendary Hand Cannon"},"Nightfall: Strange Terrain":{name:"BrayTech Osprey",icon:"/common/destiny2_content/icons/659ebe95206951d7c97022b47a93c459.jpg",description:"Expected Use Timeframe: UNKNOWN.",type:"Legendary Rocket Launcher"},"Nightfall: Savathûn's Song":{name:"Duty Bound",icon:"/common/destiny2_content/icons/0497af906c184a43fa7e2accae899c35.jpg",description:'"Due respect, Commander? I was there when the Hive found us on Earth. I was there when we stopped them on Titan. And I\'ll be there when we wipe them out." —Sloane',type:"Legendary Auto Rifle"},"Nightfall: The Pyramidion":{name:"Silicon Neuroma",icon:"/common/destiny2_content/icons/77364d95fdc16bb1d23f6f00817dc6ab.jpg",description:'"My future is concurrently irreversible and unknowable. Before it overtakes me, I desire a more abrupt end to those responsible." —Asher Mir',type:"Legendary Sniper Rifle"},"Nightfall: The Arms Dealer":{name:"Tilt Fuse",icon:"/common/destiny2_content/icons/a2dd642b18b15f764db069f845f5173c.jpg",description:'"[whistle] With a few more revs, Zahn woulda turned this thing into the fastest bomb you never saw. Good thing for all of us he never got the chance." —Amanda Holliday',type:"Exotic Sparrow"},"Nightfall: Exodus Crash":{name:"Impact Velocity",icon:"/common/destiny2_content/icons/4d0ecd27dd8a6d02a8a0f3b2618a097e.jpg",description:'"Captain, this conveyance\'s top speed is a fraction of the Exodus Black\'s when it crashed into Nessus!" "Try not to find out for yourself." —Failsafe',type:"Exotic Sparrow"},"Nightfall: The Inverted Spire":{name:"Trichromatica",icon:"/common/destiny2_content/icons/bb72e6b7b2a7ac6165431d4a47171b2f.jpg",description:"\"Void, Solar, then Arc. Hmm. We're not naive enough to think the order is a coincidence. But we've got bigger things to worry about.\" —Zavala",type:"Exotic Ghost Shell"},"Nightfall: A Garden World":{name:"Universal Wavefunction",icon:"/common/destiny2_content/icons/d6c77755df5761e5626b052d440cf5c7.jpg",description:'"I believed your presence at the genesis of the Infinite Forest would lead to a comprehensive understanding of the Vex. When will I learn that things are never so simple?" —Ikora',type:"Exotic Ship"},"Nightfall: Lake of Shadows":{name:"The Militia's Birthright",icon:"/common/destiny2_content/icons/39b67dae56153d70e935bfad21faecc7.jpg",description:'"Earth is our home. Not Mars, not Venus, not even the Reef. We must ensure it is a place we can continue to live for many generations to come." —Devrim Kay',type:"Legendary Grenade Launcher"},"Nightfall: Will of the Thousands":{name:"Worm God Incarnation",icon:"/common/destiny2_content/icons/2d6ff9e9e65253a82ec0856f310e2b94.jpg",description:"Modifications for your ship's transmat systems, so you'll always arrive in style.",type:"Legendary Transmat Effect"},"Nightfall: The Insight Terminus":{name:"The Long Goodbye",icon:"/common/destiny2_content/icons/fe07633a2ee87f0c00d5b0c0f3838a7d.jpg",description:'Yeah… I lost a lot of these out on Nessus. Long story. Lots of dead Vex." —The Drifter',type:"Legendary Sniper Rifle"},"Nightfall: The Hollowed Lair":{name:"Mindbender's Ambition",icon:"/common/destiny2_content/icons/0d39a47ea705e188a3674fa5f41b99a5.jpg",description:'"Hiraks always did like to leave an impression." —The Spider',type:"Legendary Shotgun"},"Nightfall: Warden of Nothing":{name:"Warden's Law",icon:"/common/destiny2_content/icons/89a68f864854dd80155eb194ee8f5cb7.jpg",description:"Fight. Win. Li- Li- Li- Li- Li- FATAL EXCEPTION HAS OCCURRED AT 0028:C001E36",type:"Legendary Hand Cannon"},"Nightfall: The Corrupted":{name:"Horror's Least",icon:"/common/destiny2_content/icons/c5454c80b15ecb3b3abf2d69d4bfe5ff.jpg",description:'"Some things should not be saved." —Techeun Sedia',type:"Legendary Pulse Rifle"}};function n(n,t,i="vertical"){str='\n    <div class="grid-item col-md-4">\n      <div class="mb-3 border-warning border">\n        <div class="border-warning border-bottom p-2 text-left">'+t+'</div>\n        <div class="pl-2 pr-2 pt-2 pb-1 '+("vertical"==i?"":"d-md-flex flex-md-wrap justify-content-md-around")+'">\n    ';for(var o=0;o<n.length;o++){var a="",r="";n[o].description&&(n[o].cost&&(r="<div class='mt-2'>Price: "+n[o].cost+" "+n[o].cost_name+"</div>"),a="Nightfalls"==t&&Object.keys(e).includes(n[o].name)?"\n          <div>\n            <h6 class='font-weight-bold mb-1'>"+n[o].name+"</h6>\n            <div class='mb-1'>\n              "+n[o].description.replace(/"/g,"'")+"\n            </div>\n            <div class='d-flex align-items-start mt-2'>\n              <div>\n                <img src='https://bungie.net"+e[n[o].name].icon+"' class='mt-1 mb-1 mr-2 tooltip-icon' style='width: 50px; height: 50px;'/>\n              </div>\n              <div>\n                <div class='text-weight-bold'><h6 class='mb-1'>"+e[n[o].name].name+"</h6></div>\n                <div>"+e[n[o].name].type.replace(/"/g,"'")+"</div>\n              </div>\n            </div>\n          </div>\n          ":"\n          <div>\n            <h6 class='font-weight-bold mb-1'>"+n[o].name+"</h6>\n            <div class='d-flex align-items-start'>\n              <div>\n                <img src='https://bungie.net"+n[o].icon+"' class='mt-1 mb-1 mr-2 tooltip-icon' style='width: 50px; height: 50px;'/>\n              </div>\n              <div>"+n[o].description.replace(/"/g,"'")+"</div>\n            </div>\n            "+r+"\n          </div>\n          "),str+='\n      <div class="d-flex mb-1 vendor-item" data-toggle="tooltip" title="'+a+'">\n        <img class="img-fluid" src="https://bungie.net'+n[o].icon+'" style="width: 20px; height: 20px; margin-right: 5px;"/>'+n[o].name+"\n      </div>\n      "}return str+="\n        </div>\n      </div>\n    </div>\n    ",str}});
