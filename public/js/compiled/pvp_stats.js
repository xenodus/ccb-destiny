var queueStatus=0,valorRanks=["Guardian","Brave","Heroic","Fabled","Mythic","Legend"],gloryRanks=["Guardian I","Guardian II","Guardian III","Brave I","Brave II","Brave III","Heroic I","Heroic II","Heroic III","Fabled I","Fabled II","Fabled III","Mythic I","Mythic II","Mythic III","Legend"];$(document).ready(function(){$.get("/bungie/members/get",function(a){a.length>0?($(".loader-text").text("Fetching PvP Stats..."),$.get("/bungie/pvp/get",function(e){for(var t=[],r=0;r<a.length;r++)$(".loader-text").text("Processing "+(r+1)+" of "+a.length+"..."),pvpData=e.filter(function(e){return e.user_id==a[r].destinyUserInfo.membershipId})[0],glory_rank=pvpData.glory_step==gloryRanks.length?gloryRanks[gloryRanks.length-1]:gloryRanks[pvpData.glory_step],valor_rank=pvpData.valor_step==valorRanks.length?valorRanks[valorRanks.length-1]:valorRanks[pvpData.valor_step],t.push({name:a[r].destinyUserInfo.displayName,kd:pvpData.kd,kda:pvpData.kda,kad:pvpData.kad,glory:pvpData.glory,glory_step:glory_rank,valor:pvpData.valor,valor_step:valor_rank,valor_resets:pvpData.valor_resets});$(".loader-text").text("Generating Table..."),$(".stats-container").append('<div id="pvp-stats-table"></div>'),$(".loader").hide(),$(".loader-text").hide();var l={precision:0};new Tabulator("#pvp-stats-table",{data:t,layout:"fitColumns",columns:[{title:"Name",field:"name",formatter:"money",formatterParams:l,frozen:!0},{title:"KD",field:"kd",formatter:"money",formatterParams:{precision:2}},{title:"KDA",field:"kda",formatter:"money",formatterParams:{precision:2}},{title:"KAD",field:"kad",formatter:"money",formatterParams:{precision:2}},{title:"Glory",field:"glory",formatter:"money",formatterParams:l},{title:"Glory Rank",field:"glory_step"},{title:"Valor",field:"valor",formatter:"money",formatterParams:l},{title:"Valor Rank",field:"valor_step"},{title:"Valor Resets",field:"valor_resets",formatter:"money",formatterParams:l}],initialSort:[{column:"glory",dir:"desc"}],layout:"fitDataFill",resizableColumns:!1}),$(".stats-container").append('<div id="weapon-stats-info" class="text-center"><small>Last checked: '+pvpData.last_updated+"</small></div>")})):$(".loader-text").html("Unable to retrieve members ðŸ˜Ÿ <br/>Bungie API might be under maintenance")})});
