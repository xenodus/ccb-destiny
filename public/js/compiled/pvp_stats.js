var valorRanks=["Guardian","Brave","Heroic","Fabled","Mythic","Legend"],gloryRanks=["Guardian I","Guardian II","Guardian III","Brave I","Brave II","Brave III","Heroic I","Heroic II","Heroic III","Fabled I","Fabled II","Fabled III","Mythic I","Mythic II","Mythic III","Legend"];$(document).ready(function(){function t(){$.get("/bungie/members/get",function(t){$(".loader-text").text("Fetching PvP Stats..."),$.get("/bungie/pvp/get",function(a){for(var e=[],r=0;r<t.length;r++)$(".loader-text").text("Processing "+(r+1)+" of "+t.length+"..."),pvpData=a.filter(function(a){return a.user_id==t[r].destinyUserInfo.membershipId})[0],glory_rank=pvpData.glory_step==gloryRanks.length?gloryRanks[gloryRanks.length-1]:gloryRanks[pvpData.glory_step],valor_rank=pvpData.valor_step==valorRanks.length?valorRanks[valorRanks.length-1]:valorRanks[pvpData.valor_step],e.push({name:t[r].destinyUserInfo.displayName,kd:pvpData.kd,kda:pvpData.kda,kad:pvpData.kad,glory:pvpData.glory,glory_step:glory_rank,valor:pvpData.valor,valor_step:valor_rank,valor_resets:pvpData.valor_resets});$(".loader-text").text("Generating Table..."),$(".stats-container").append('<div id="pvp-stats-table"></div>'),$(".loader").hide(),$(".loader-text").hide();var o={precision:0};new Tabulator("#pvp-stats-table",{data:e,layout:"fitColumns",columns:[{title:"Name",field:"name",formatter:"money",formatterParams:o,frozen:!0},{title:"KD",field:"kd",formatter:"money",formatterParams:{precision:2}},{title:"KDA",field:"kda",formatter:"money",formatterParams:{precision:2}},{title:"KAD",field:"kad",formatter:"money",formatterParams:{precision:2}},{title:"Glory",field:"glory",formatter:"money",formatterParams:o},{title:"Glory Rank",field:"glory_step"},{title:"Valor",field:"valor",formatter:"money",formatterParams:o},{title:"Valor Rank",field:"valor_step"},{title:"Valor Resets",field:"valor_resets",formatter:"money",formatterParams:o}],initialSort:[{column:"glory",dir:"desc"}],layout:"fitDataFill",height:"350px"});$(".stats-container").append('<div id="weapon-stats-info" class="text-center"><small>Last checked: '+pvpData.last_updated+'</small> <br/><button type="button" class="btn btn-primary btn-sm badge badge-info refresh-btn"><i class="fas fa-sync-alt"></i> Resync data</button></div>')})})}$(document).on("click","button.refresh-btn",function(){refreshBtn=$(this),refreshBtn.prop("disabled",!0),$(".loader").show(),$(".loader-text").show(),$(".loader-text").text("Refreshing data. Go grab a drink..."),$(".stats-container").empty(),$.get("/bungie/pvp/update",function(a){refreshBtn.prop("disabled",!1),t()})}),t()});
