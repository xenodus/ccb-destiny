$(document).ready(function(){function t(){$.get("/bungie/members/get",function(t){$(".loader-text").text("Fetching Raid Stats..."),$.get("/bungie/raid/get",function(a){for(var e=[],r=0;r<t.length;r++)$(".loader-text").text("Processing "+(r+1)+" of "+t.length+"..."),raidData=a.filter(function(a){return a.user_id==t[r].destinyUserInfo.membershipId})[0],e.push({name:t[r].destinyUserInfo.displayName,levi:raidData.levi,levip:raidData.levip,eow:raidData.eow,eowp:raidData.eowp,sos:raidData.sos,sosp:raidData.sosp,lw:raidData.lw,petra:raidData.petra>0?'<div class="text-center"><i class="fas fa-check text-success"></i></div>':'<div class="text-center"><i class="fas fa-times text-danger"></i></div>',sotp:raidData.sotp,diamond:raidData.diamond>0?'<div class="text-center"><i class="fas fa-check text-success"></i></div>':'<div class="text-center"><i class="fas fa-times text-danger"></i></div>',total:raidData.levi+raidData.levip+raidData.eow+raidData.eowp+raidData.sos+raidData.sosp+raidData.lw+raidData.sotp});$(".loader-text").text("Generating Table..."),$(".stats-container").append('<div id="raid-stats-table"></div>'),$(".loader").hide(),$(".loader-text").hide();var i={precision:0};new Tabulator("#raid-stats-table",{data:e,layout:"fitColumns",columns:[{title:"Name",field:"name",formatter:"money",formatterParams:i,frozen:!0},{title:"Levi",field:"levi",formatter:"money",formatterParams:i},{title:"P Levi",field:"levip",formatter:"money",formatterParams:i},{title:"EOW",field:"eow",formatter:"money",formatterParams:i},{title:"P EOW",field:"eowp",formatter:"money",formatterParams:i},{title:"SOS",field:"sos",formatter:"money",formatterParams:i},{title:"P SOS",field:"sosp",formatter:"money",formatterParams:i},{title:"Last Wish",field:"lw",formatter:"money",formatterParams:i},{title:"Petra",field:"petra",formatter:"html"},{title:"SoTP",field:"sotp",formatter:"money",formatterParams:i},{title:"Diamond",field:"diamond",formatter:"html"},{title:"Total",field:"total",formatter:"money",formatterParams:i}],initialSort:[{column:"total",dir:"desc"}],layout:"fitDataFill",height:"350px"});$(".stats-container").append('<div id="raid-stats-info" class="text-center"><small>Last checked: '+raidData.last_updated+'</small> <br/><button type="button" class="btn btn-primary btn-sm badge badge-info refresh-btn"><i class="fas fa-sync-alt"></i> Resync data</button></div>')})})}$(document).on("click","button.refresh-btn",function(){refreshBtn=$(this),refreshBtn.prop("disabled",!0),$(".loader").show(),$(".loader-text").show(),$(".loader-text").text("Refreshing data. Go grab a drink..."),$(".stats-container").empty(),$.get("/bungie/raid/update",function(a){refreshBtn.prop("disabled",!1),t()})}),t()});
