var queueStatus=0;$(document).ready(function(){function t(){$(".loader").show(),$(".loader-text").show(),0==queueStatus&&$(".loader-text").text("Refreshing data (~1 min). Go grab a drink..."),$(".stats-container").empty(),$.get("/bungie/raid/update",function(a){2==a.status?($(".loader-text").text("Resync already in progress. Queueing..."),queueStatus=1,setTimeout(t,5e3)):(queueStatus=0,refreshBtn=$("button.refresh-btn"),refreshBtn.prop("disabled",!1),e())})}function e(){$.get("/bungie/members/get",function(t){$(".loader-text").text("Fetching Raid Stats..."),$.get("/bungie/raid/get",function(e){for(var a=[],r=0;r<t.length;r++)$(".loader-text").text("Processing "+(r+1)+" of "+t.length+"..."),raidData=e.filter(function(e){return e.user_id==t[r].destinyUserInfo.membershipId})[0],a.push({membershipId:t[r].destinyUserInfo.membershipId,name:'<a href="https://raid.report/pc/'+t[r].destinyUserInfo.membershipId+'" target="_blank" class="text-dark">'+t[r].destinyUserInfo.displayName+"</a>",levi:raidData.levi,levip:raidData.levip,eow:raidData.eow,eowp:raidData.eowp,sos:raidData.sos,sosp:raidData.sosp,lw:raidData.lw,petra:raidData.petra>0?'<div class="text-center"><i class="fas fa-check text-success"></i></div>':'<div class="text-center"><i class="fas fa-times text-danger"></i></div>',sotp:raidData.sotp,diamond:raidData.diamond>0?'<div class="text-center"><i class="fas fa-check text-success"></i></div>':'<div class="text-center"><i class="fas fa-times text-danger"></i></div>',cos:raidData.cos,crown:raidData.crown>0?'<div class="text-center"><i class="fas fa-check text-success"></i></div>':'<div class="text-center"><i class="fas fa-times text-danger"></i></div>',total:raidData.levi+raidData.levip+raidData.eow+raidData.eowp+raidData.sos+raidData.sosp+raidData.lw+raidData.sotp+raidData.cos});$(".loader-text").text("Generating Table..."),$(".stats-container").append('<div id="raid-stats-table"></div>'),$(".loader").hide(),$(".loader-text").hide();var s={precision:0};new Tabulator("#raid-stats-table",{data:a,layout:"fitColumns",columns:[{title:"Name",field:"name",formatter:"html",formatterParams:s,frozen:!0},{title:"Member ID",field:"membershipId",visible:!1,cssClass:"memberID"},{title:"Levi",field:"levi",formatter:"money",formatterParams:s},{title:"P Levi",field:"levip",formatter:"money",formatterParams:s},{title:"EOW",field:"eow",formatter:"money",formatterParams:s},{title:"P EOW",field:"eowp",formatter:"money",formatterParams:s},{title:"SOS",field:"sos",formatter:"money",formatterParams:s},{title:"P SOS",field:"sosp",formatter:"money",formatterParams:s},{title:"LW",field:"lw",formatter:"money",formatterParams:s},{title:"Flawless LW",field:"petra",formatter:"html"},{title:"SoTP",field:"sotp",formatter:"money",formatterParams:s},{title:"Flawless SoTP",field:"diamond",formatter:"html"},{title:"CoS",field:"cos",formatter:"money",formatterParams:s},{title:"Flawless CoS",field:"crown",formatter:"html"},{title:"Total",field:"total",formatter:"money",formatterParams:s}],initialSort:[{column:"total",dir:"desc"}],layout:"fitDataFill",resizableColumns:!1});$(".stats-container").append('<div id="raid-stats-info" class="text-center"><small>Last checked: '+raidData.last_updated+'</small> <br/><button type="button" class="btn btn-primary btn-sm badge badge-info refresh-btn"><i class="fas fa-sync-alt"></i> Resync data</button></div>')})})}$(document).on("click","button.refresh-btn",function(){refreshBtn=$(this),refreshBtn.prop("disabled",!0),t()}),e()});
